import{d7 as S,d8 as w,b7 as b,q as A,t as h,v as f,G as E,K as x,d9 as N,f as p,ap as c,x as m,a2 as O,ah as R,y as z,z as $,da as j,db as D,E as C,dc as K}from"./index-k_q90Oa5.js";var v,_=w.named("MappingStore").props({fetching:!1,errorMsg:"",valueField:"value",map:j.frozen({})}).actions(function(d){var o=D(function(e,t,r){var a,n,i;return C(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,3,4]),d.fetching=!0,[4,e.fetcher(t,r)];case 1:if(a=l.sent(),a.ok)n=K(a.data),d.setMap(Array.isArray(n.options)?n.options:Array.isArray(n.items)?n.items:n);else throw new Error(a.msg||"fetch error");return[3,4];case 2:return i=l.sent(),d.errorMsg=i.message,[3,4];case 3:return d.fetching=!1,[7];case 4:return[2]}})});return{load:o,setMap:function(e){Array.isArray(e)&&(e=e.reduce(function(t,r){if(r==null)return t;if(c(r)){var a=Object.keys(r);a.length===1||a.length==2&&a.includes("$$id")?(a=a.filter(function(n){return n!=="$$id"}),t[a[0]]=r[a[0]]):a.length>1&&(t[r[d.valueField]]=r)}return t},{})),c(e)&&(d.map=m({},e))}}}),P=S(function(d){return _.create({id:b(),storeType:_.name},d.env)})((v=function(d){A(o,d);function o(e){var t=d.call(this,e)||this;return e.store.syncProps(e,void 0,["valueField","map"]),t}return o.prototype.componentDidMount=function(){this.reload()},o.prototype.componentDidUpdate=function(e){var t=this.props,r=this.props,a=r.store,n=r.source,i=r.data;if(a.syncProps(t,e,n?["valueField"]:["valueField","map"]),h(n)){var l=f(e.source,e.data,"| raw"),s=f(n,i,"| raw");l!==s&&a.setMap(s)}else E(e.source,t.source,e.data,t.data)&&this.reload()},o.prototype.reload=function(){var e,t=this.props,r=t.source,a=t.data,n=t.env,i=this.props.store;if(h(r))i.setMap(f(r,a,"| raw"));else if(x(r,a)){var l=N(r,"get");l.cache=(e=l.cache)!==null&&e!==void 0?e:30*1e3,i.load(n,l,a)}},o.prototype.renderSingleValue=function(e,t,r){var a,n=this.props,i=n.className,l=n.style,s=n.placeholder,V=n.classnames,F=n.store,g=p.createElement("span",{className:"text-muted"},s),u=F.map,y=void 0;e=typeof e=="string"?e.trim():e;var M=r?l:void 0;return typeof e<"u"&&u&&(y=(a=u[e])!==null&&a!==void 0?a:e===!0&&u[1]?u[1]:e===!1&&u[0]?u[0]:u["*"])!==void 0&&(g=this.renderViewValue(y)),p.createElement("span",{key:"map-".concat(t),className:V("MappingField",i),style:M},g)},o.prototype.renderViewValue=function(e){var t=this.props,r=t.render,a=t.itemSchema,n=t.data,i=t.labelField,l=t.name;if(!a){var s=e;return c(e)&&(i===void 0||i===""?e.hasOwnProperty("type")?s=m({name:l},s):s=e.label:s=e[i||"label"]),c(s)&&s.type==="tag"&&!c(s.label)&&s.label!=null?r("mapping-tag",s,{value:null}):r("tpl",s)}return r("mappingItemSchema",a,m({data:O(n,c(e)?e:{item:e})},(a==null?void 0:a.type)==="tag"?{value:null}:{}))},o.prototype.render=function(){var e=this,t=this.props,r=t.style,a=t.defaultValue,n=t.data,i=R(this.props);return a&&h(a)&&a===i&&(i=f(a,n,"| raw")),Array.isArray(i)?p.createElement("span",{style:r},i.map(function(l,s){return e.renderSingleValue(l,s)})):this.renderSingleValue(i,0,!0)},o}(p.Component),v.defaultProps={placeholder:"-",map:{"*":"通配值"}},v)),G=function(d){A(o,d);function o(){return d!==null&&d.apply(this,arguments)||this}return o.prototype.render=function(){return p.createElement(P,m({},this.props))},o=z([$({type:"mapping",alias:["map"],name:"mapping"})],o),o}(p.Component);export{P as MappingField,G as MappingFieldRenderer,_ as Store};
