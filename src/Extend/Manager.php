<?php
/*   __________________________________________________
    |  Obfuscated by YAK Pro - Php Obfuscator  2.0.16  |
    |              on 2025-06-22 09:38:12              |
    |    GitHub: https://github.com/pk-fr/yakpro-po    |
    |__________________________________________________|
*/
 namespace DagaSmart\BizAdmin\Extend; use RuntimeException; use FilesystemIterator; use Illuminate\Support\Str; use DagaSmart\BizAdmin\Admin; use RecursiveIteratorIterator; use RecursiveDirectoryIterator; use DagaSmart\BizAdmin\Support\Zip; use Illuminate\Support\Collection; use Illuminate\Support\Facades\DB; use Illuminate\Support\Facades\Schema; use DagaSmart\BizAdmin\Support\Helper; use Illuminate\Filesystem\Filesystem; use DagaSmart\BizAdmin\Support\Composer; use Illuminate\Contracts\Container\Container; use Psr\Container\NotFoundExceptionInterface; use Psr\Container\ContainerExceptionInterface; use DagaSmart\BizAdmin\Models\Extension as ExtensionModel; class Manager { protected Container $app; protected Collection|array $extensions; protected array $extensionPaths = []; protected $settings; protected mixed $files; public function __construct(Container $OyGjS) { goto gKCVY; fiirq: $this->files = app("\x66\151\154\x65\x73"); goto sA_KJ; gKCVY: $this->app = $OyGjS; goto mr61Y; mr61Y: $this->extensions = new Collection(); goto fiirq; sA_KJ: } public function register() { $this->load(); $this->extensions->each->register(); } public function boot() { $this->extensions->each->boot(); } public function initRoutes() { $this->extensions->each->initRoutes(); } public function disabled(?string $jFQ2o) : ?bool { goto DfRno; xV0Up: return true; goto vCsTV; Vo5YT: return DB::table("\x61\144\155\x69\156\137\145\170\x74\x65\156\x73\151\x6f\156\163")->where("\143\x6f\x64\145", $jFQ2o)->where("\155\157\x64\165\154\x65", Admin::currentModule(true))->where("\151\163\x5f\145\x6e\141\x62\x6c\145\144", 1)->exists(); goto Tu3qx; Tu3qx: pJ7yM: goto xV0Up; DfRno: if (!Schema::hasTable("\141\x64\x6d\x69\x6e\137\145\170\164\145\x6e\x73\151\157\156\163")) { goto pJ7yM; } goto Vo5YT; vCsTV: } public function enabled(?string $jFQ2o, $QOmn1 = null) { $MWice = new ExtensionModel(); return $MWice->isEnabled($jFQ2o, $QOmn1); } public function used(?string $jFQ2o, $QOmn1 = null) { $MWice = new ExtensionModel(); return $MWice->isUsed($jFQ2o, $QOmn1); } public function enable($J6yf0) { goto XQNKJ; LjfnF: if (!$IYtBO->save()) { goto uufFW; } goto T5KX0; v_LHx: Admin::extension($jFQ2o)->install(); goto KZ2_0; B2h2k: $IYtBO = ExtensionModel::query()->where("\x63\x6f\x64\145", $jFQ2o)->where("\x6d\x65\x72\137\x69\x64", Admin::merId())->first(); goto yaDL4; jtgjC: admin_abort_if(!$J6yf0->name, "\x6e\x61\x6d\145\344\xb8\215\xe8\203\xbd\344\270\xba\347\xa9\xba"); goto KsdBY; yaDL4: if ($IYtBO) { goto WSF1x; } goto w61I_; T5KX0: Admin::extension($jFQ2o)->doEnable($J6yf0->enabled); goto b3ArV; XQNKJ: admin_abort_if(!$J6yf0->code, "\x63\157\144\x65\xe4\xb8\215\350\x83\275\344\270\xba\347\251\xba"); goto jtgjC; b3ArV: uufFW: goto EUjSI; KsdBY: $jFQ2o = $this->getCode($J6yf0->code); goto B2h2k; hno3q: $IYtBO->is_enabled = $J6yf0->enabled ? 1 : 0; goto LjfnF; KZ2_0: WSF1x: goto cjA0D; cjA0D: $IYtBO->code = $J6yf0->code; goto hno3q; w61I_: $IYtBO = ExtensionModel::query()->create(["\x6e\x61\x6d\145" => $J6yf0->name, "\143\157\x64\145" => $jFQ2o, "\x69\x73\x5f\145\156\x61\x62\154\145\144" => $J6yf0->enabled, "\x6d\157\x64\x75\x6c\x65" => Admin::currentModule(true), "\155\x65\x72\137\x69\x64" => Admin::merId()]); goto v_LHx; EUjSI: } public function load() { goto Gr4fk; Gr4fk: foreach ($this->getExtensionDirectories() as $CkNWZ) { try { $this->loadExtension($CkNWZ); } catch (\Throwable $FXDMR) { } pcWoU: } goto oK6eD; fSMB6: return $this; goto fxpuP; oK6eD: Zc8ns: goto fSMB6; fxpuP: } public function path($yE039, $ZkOaA = null) { goto H1bxt; H1bxt: if ($IYtBO = $this->get($yE039)) { goto M9cTP; } goto k0vfy; kZIlg: return $IYtBO->path($ZkOaA); goto Uudsz; oWwQ7: M9cTP: goto kZIlg; k0vfy: return; goto oWwQ7; Uudsz: } public function get($yE039) { goto lRmFO; Lnq0z: TmLcq: goto wfI1B; rYmVF: return $yE039; goto Lnq0z; wfI1B: return $this->extensions->get($this->formatName($yE039)); goto gwxUy; lRmFO: if (!$yE039 instanceof ServiceProvider) { goto TmLcq; } goto rYmVF; gwxUy: } public function has($yE039) { return $this->extensions->has($this->formatName($yE039)); } protected function formatName($yE039) { goto CA0jC; i10Pr: return $yE039; goto rZyhO; rZyhO: Gbzyj: goto rV1MU; rV1MU: return str_replace("\x2f", "\56", $yE039); goto Ov_0a; CA0jC: if (is_string($yE039)) { goto Gbzyj; } goto i10Pr; Ov_0a: } public function all() { return $this->extensions; } public function available() { return $this->all()->filter->enabled(); } public function loadExtension(string $CkNWZ, bool $KS0EL = true) { goto fZHVs; PeBiU: $this->extensionPaths[$CkNWZ] = $jP533 = $this->resolveExtension($CkNWZ, $KS0EL); goto ePqS3; E9zJW: RHniV: goto JXRTG; JXRTG: return $jP533; goto IKTvC; zf30C: zESWV: goto PeBiU; ePqS3: if (!$jP533) { goto RHniV; } goto cdcHH; Rxhkw: return $this->extensionPaths[$CkNWZ]; goto zf30C; fZHVs: if (!array_key_exists($CkNWZ, $this->extensionPaths)) { goto zESWV; } goto Rxhkw; cdcHH: $this->addExtension($jP533); goto E9zJW; IKTvC: } public function resolveExtension(string $CkNWZ, bool $KS0EL = true) { goto EaHEa; vO8GL: return; goto cTR_M; yXBTt: $Dx7kU = $qLRGO->get("\141\x75\x74\157\154\x6f\x61\144\x2e\x70\x73\162\x2d\64"); goto Pu72Z; Pu72Z: $nYtpa = $qLRGO->get("\141\x75\164\157\154\157\141\144\x2e\x66\x69\x6c\145\163"); goto xN89w; vJeTg: return $jP533->withComposerProperty($qLRGO); goto ihwpQ; EaHEa: $qLRGO = Composer::parse($CkNWZ . "\x2f\x63\157\x6d\x70\157\x73\145\x72\x2e\152\x73\x6f\156"); goto xaDA5; MVWHg: $this->registerPsr4($CkNWZ, $Dx7kU); goto X6hVz; pfBHl: if (!$KS0EL) { goto kBCtd; } goto MVWHg; X6hVz: $this->registerFiles($CkNWZ, $nYtpa); goto DIu_l; ZY_ss: $jP533 = new $jP533($this->app); goto vJeTg; DIu_l: kBCtd: goto ZY_ss; xaDA5: $jP533 = $qLRGO->get("\145\170\164\162\141\56\142\x69\172\141\x64\x6d\151\x6e"); goto yXBTt; xN89w: if (!(!$jP533 || !$Dx7kU)) { goto jS2TQ; } goto vO8GL; cTR_M: jS2TQ: goto pfBHl; ihwpQ: } public function getExtensionDirectories(string $s6rN3 = null) { goto nJFRx; sZzRA: MAFDk: goto DEII6; l1vqR: $OamMG[] = dirname($WmESw->getPathname()); goto HXB86; yOOZp: return $OamMG; goto kgz7K; nJFRx: $OamMG = []; goto q0i3V; PXIvb: s5Z2H: goto LhiHc; DEII6: return $OamMG; goto MzUvs; ckPAG: $WmESw = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($s6rN3, FilesystemIterator::FOLLOW_SYMLINKS)); goto XEtyl; XEtyl: $WmESw->setMaxDepth(2); goto GJjTW; Eb4hl: if (!($WmESw->getDepth() > 1 && $WmESw->getFilename() === "\x63\157\x6d\x70\157\x73\145\162\56\152\163\x6f\156")) { goto JihSS; } goto l1vqR; LhiHc: if (!$WmESw->valid()) { goto MAFDk; } goto Eb4hl; tvv2w: goto s5Z2H; goto sZzRA; q0i3V: $s6rN3 = $s6rN3 ?: admin_extension_path(); goto pc4Xn; kgz7K: PV57B: goto ckPAG; R4uTn: $WmESw->next(); goto tvv2w; pc4Xn: if (is_dir($s6rN3)) { goto PV57B; } goto yOOZp; HXB86: JihSS: goto R4uTn; GJjTW: $WmESw->rewind(); goto PXIvb; MzUvs: } public function addExtension(ServiceProvider $jP533) { goto ObMFQ; EQ0T5: z6ek9: goto cBgCN; hxVWc: $this->extensions->put($jP533->getCode(), $jP533); goto iB0Se; iB0Se: $this->app->instance($oxlDp = get_class($jP533), $jP533); goto UysEr; UysEr: $this->app->alias($oxlDp, $jP533->getCode()); goto eN2jQ; zL3oU: $bHP5Y = dirname(Helper::guessClassFileName($jP533), 2) . "\57\x63\157\155\160\157\x73\x65\x72\x2e\152\163\157\156"; goto Id_Bz; Id_Bz: if (is_file($bHP5Y)) { goto z6ek9; } goto OlsII; ObMFQ: if ($jP533->getCode()) { goto vwm6I; } goto zL3oU; OlsII: throw new RuntimeException(sprintf("\x45\162\162\x6f\162\40\x65\170\164\145\x6e\x73\151\x6f\156\40\42\45\x73\42", get_class($jP533))); goto EQ0T5; cBgCN: $jP533->withComposerProperty(Composer::parse($bHP5Y)); goto yVfIU; yVfIU: vwm6I: goto hxVWc; eN2jQ: } public function getCode($IYtBO) { goto Qb1ke; AicGc: return $this->formatName($IYtBO); goto z0W0f; Hso_J: Smx6d: goto AicGc; mpLrF: return $IYtBO->getCode(); goto Hso_J; Qb1ke: if (!$IYtBO instanceof ServiceProvider) { goto Smx6d; } goto mpLrF; z0W0f: } public function extract($h7w3f, bool $L_Oir = false) { goto Zq2gG; LPbgN: @unlink($h7w3f); goto GTA_u; YJdnd: $yE039 = $this->extractZip($h7w3f, $L_Oir); goto LPbgN; GTA_u: return $yE039; goto MCxJp; Zq2gG: $h7w3f = is_file($h7w3f) ? $h7w3f : $this->getFilePath($h7w3f); goto YJdnd; MCxJp: } public function extractZip($h7w3f, bool $L_Oir = false) { $VNKme = $this->makeTempDirectory(); try { goto LUx5H; D4KlU: if (Zip::extract($h7w3f, $VNKme)) { goto dxLmf; } goto z1MZI; cFN40: $CkNWZ = current($NSoMI); goto NqDfd; c3s6f: $CkNWZ = current($OamMG); goto HWaFS; X_BMJ: dxLmf: goto emq9k; DSkgW: if ($this->checkFiles($CkNWZ)) { goto xEa6V; } goto e0CGQ; LE2P3: if (count($OamMG) === 1) { goto djpd7; } goto b5y40; NqDfd: bS4aF: goto cBJiX; jwecc: $AktbB = admin_extension_path($qLRGO->name); goto VwM9Z; e0CGQ: throw new RuntimeException(sprintf("\105\162\162\157\x72\40\x65\170\164\x65\156\163\x69\157\x6e\x20\x66\151\154\x65\40\x22\45\163\42\x2e", $h7w3f)); goto Aqtu0; OmURR: sLClQ: goto d1hYm; Aqtu0: xEa6V: goto mjCVU; b5y40: if (!(count($NSoMI = $this->scandir($VNKme)) === 1)) { goto bS4aF; } goto cFN40; cBJiX: goto gWudn; goto MPBIm; A9qiy: $CkNWZ = $VNKme; goto LE2P3; AxHpL: $this->files->makeDirectory($AktbB, 0755, true); goto OmURR; HWaFS: gWudn: goto DSkgW; z1MZI: throw new \Exception(sprintf("\125\156\x61\x62\x6c\x65\40\x74\x6f\40\145\170\164\x72\x61\x63\164\x20\x63\x6f\x72\x65\40\x66\151\154\145\40\x27\45\x73\x27\56", $h7w3f)); goto X_BMJ; d1hYm: $this->files->copyDirectory($CkNWZ, $AktbB); goto X704x; MPBIm: djpd7: goto c3s6f; LUx5H: $h7w3f = is_file($h7w3f) ? $h7w3f : $this->getFilePath($h7w3f); goto D4KlU; mjCVU: $qLRGO = Composer::parse($CkNWZ . "\57\143\x6f\x6d\x70\x6f\163\145\x72\56\152\x73\157\156"); goto jwecc; X704x: return $qLRGO->name; goto diF3S; WrRpr: kZ0lk: goto Xvv28; emq9k: $OamMG = $this->getExtensionDirectories($VNKme); goto A9qiy; fCnQQ: throw new RuntimeException(sprintf("\x54\x68\x65\40\x65\170\x74\x65\x6e\163\x69\157\x6e\x20\133\45\163\x5d\40\x61\x6c\x72\145\x61\144\171\40\x65\x78\x69\163\x74\x21", $qLRGO->name)); goto WrRpr; Xvv28: if (is_dir($AktbB)) { goto sLClQ; } goto AxHpL; VwM9Z: if (!(!$L_Oir && is_dir($AktbB))) { goto kZ0lk; } goto fCnQQ; diF3S: } finally { $this->files->deleteDirectory($VNKme); } } protected function checkFiles($CkNWZ) { goto uTv7M; NtbiT: return false; goto rDMjZ; cfXD7: return true; goto AbNZB; orXNU: cwMK3: goto j2XJm; AXpxr: return false; goto orXNU; j2XJm: $qLRGO = Composer::parse($CkNWZ . "\x2f\143\157\155\160\157\163\145\x72\56\x6a\163\x6f\x6e"); goto fb9lv; rDMjZ: pkVRV: goto cfXD7; fb9lv: if (!(!$qLRGO->name || !$qLRGO->get("\x65\x78\164\162\x61\56\142\x69\172\x61\x64\155\151\x6e"))) { goto pkVRV; } goto NtbiT; uTv7M: if (!(!is_dir($CkNWZ . "\x2f\163\162\x63") || !is_file($CkNWZ . "\57\143\157\155\x70\157\163\x65\162\x2e\x6a\163\157\x6e"))) { goto cwMK3; } goto AXpxr; AbNZB: } protected function getFilePath($xc5l7) { $yE039 = md5($xc5l7) . "\x2e\141\162\x63"; return $this->makeTempDirectory("\145\x78\x74\145\156\x73\151\x6f\156\163") . "\57" . $yE039; } public function settings() { goto DWA5g; y0cvM: fNy0C: goto jkqNO; DWA5g: if (!($this->settings === null)) { goto fNy0C; } goto RV4_5; jkqNO: return $this->settings; goto x7l0x; RV4_5: try { $this->settings = ExtensionModel::keyByNameList(); } catch (\Throwable $FXDMR) { $this->settings = new Collection(); } goto y0cvM; x7l0x: } protected function makeTempDirectory($kAyjt = null) { goto Mdd65; upJyl: if ($this->files->makeDirectory($E8G6y, 0777, true)) { goto Hf3sX; } goto eg4Kv; v4NP0: return $E8G6y; goto mz0s2; zvo3w: dOpzC: goto v4NP0; eg4Kv: throw new RuntimeException(sprintf("\x43\141\x6e\156\157\164\x20\x77\x72\151\x74\145\x20\x74\x6f\x20\144\151\x72\145\143\164\x6f\x72\x79\x20\x22\x25\163\42", storage_path())); goto KNfN5; EedRy: if (is_dir($E8G6y)) { goto dOpzC; } goto upJyl; Mdd65: $E8G6y = storage_path("\164\x6d\x70\57" . ($kAyjt ?: time() . Str::random())); goto EedRy; KNfN5: Hf3sX: goto zvo3w; mz0s2: } protected function registerPsr4($CkNWZ, array $Dx7kU) { goto mXtN5; bXq84: vkU2V: goto vReWT; mXtN5: $e0_a_ = Admin::classLoader(); goto bPnI4; bPnI4: foreach ($Dx7kU as $qTwQf => $ZkOaA) { goto kYe1N; D0y1G: $e0_a_->addPsr4($qTwQf, $ZkOaA); goto Opi9y; Opi9y: G807S: goto GNiL8; kYe1N: $ZkOaA = $CkNWZ . "\x2f" . trim($ZkOaA, "\x2f") . "\x2f"; goto D0y1G; GNiL8: } goto bXq84; vReWT: } protected function registerFiles($CkNWZ, $nYtpa) { goto PiCHs; t1r_Z: return; goto oFbN2; g9A1S: mze9m: goto CDtTy; oFbN2: zhqjX: goto y9GwL; PiCHs: if (!empty($nYtpa)) { goto zhqjX; } goto t1r_Z; y9GwL: foreach ($nYtpa as $o0zdn) { goto dDSxJ; dDSxJ: $Jg13p = $CkNWZ . "\x2f" . trim($o0zdn, "\57"); goto stQ3j; stQ3j: if (!is_file($Jg13p)) { goto ioN3c; } goto NHvbD; NHvbD: require_once $Jg13p; goto jf0dQ; W7Plq: kXpBn: goto uZEEu; jf0dQ: ioN3c: goto W7Plq; uZEEu: } goto g9A1S; CDtTy: } protected function scandir($kAyjt) { goto XwHSs; dueWE: RNlGa: goto m_g30; m_g30: return $NSoMI; goto moTEx; XwHSs: $NSoMI = []; goto tbCGc; tbCGc: foreach (scandir($kAyjt) as $IyStN) { goto T6FD4; NJyvz: tXhaW: goto fb8qu; wFEuB: $NSoMI[] = $IyStN; goto NJyvz; T6FD4: if (!($IyStN !== "\x2e" && $IyStN !== "\56\56" && is_dir($IyStN = $kAyjt . "\x2f" . $IyStN))) { goto tXhaW; } goto wFEuB; fb8qu: mKFsr: goto HpcJS; HpcJS: } goto dueWE; moTEx: } }
